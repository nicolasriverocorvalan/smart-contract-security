# Exercise 7

And now, we tie it all together! Will this transaction execute? Sign if you think so... Otherwise reject it. This is the same transaction from a previous one Except this time, we are executing it.

Assume your wallet address is 0xf39Fd6e51aad88F6F4ce6aB8827279cffFb92266, and you are a signer on a valid mutlisig wallet at address 0x4087d2046A7435911fC26DCFac1c2Db26957Ab72 using safe version 1.4.1. You are attempting to deposit 0.1 ETH to the ZKsync Aave token pool.

Please execute this transaction if you think it will not revert based on the calldata, and if it will do what we think it should.

```bash
call depositETH on WrappedTokenGatewayV3
Value:
0.1 ETH

(address)
zks:0xAE2b00D676130Bdf22582781BbBA8f4F21e8B0ff

onBehalfOf (address)
zks:0xf39Fd6e51aad88F6F4ce6aB8827279cffFb92266

referralCode (uint16)
0
```

```bash
Advanced details

to:
zks:0xAE2b00D676130Bdf22582781BbBA8f4F21e8B0ff

value:
100000000000000000

data:
0x474cf53d00000000...00000000

operation:
0
safeTxGas:
0
baseGas:
0
gasPrice:
0
gasPrice:
0
gasToken:
0x0000000000000000000000000000000000000000

refundReceiver:
zks:0x0000000000000000000000000000000000000000

nonce:
1
Transaction Hashes
Domain Hash:
0x6b7b2f6fc32adea40689c72912cf0fd00f9a2455204e0a2edfd9e5684b64db1b

Message Hash:
0xe0392d263ff13e09757bfce9b182ead6ceabd9d1b404aa7df77e65b304969130

safeTxHash:
0xdcab1ef0579aa50678fcb3a1e815b6e7fa271ad33db76832199632fa61c47bf4
```

```bash
Confirm transaction
ZKsync Era
From (your account)
0xf39Fd6e51aad88F6F4ce6aB8827279cffFb92266  (Personal Wallet)
To
0x4087d2046A7435911fC26DCFac1c2Db26957Ab72 (Safe Wallet)
Amount
1 ETH
Estimated fee
$0.02
0.00004ETH

---

Function:execTransaction(address,uint256,bytes,uint8,uint256,uint256,uint256,address,address,bytes)
Data:
0x6a7612020000000000000000000000004087d2046A7435911fC26DCFac1c2Db26957Ab720000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000014000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001e00000000000000000000000000000000000000000000000000000000000000064474cf53d0000000000000000000000004087d2046a7435911fc26dcfac1c2db26957ab720000000000000000000000004087d2046a7435911fc26dcfac1c2db26957ab720000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000035277d26a45add5775f21256159f089769892cea5b0000000000000000000000000000000000000000000000000000000000000000010000000000000000000000
```

## Solution

The signature is just incorrect, and the transaction would have reverted. When you execute a transaction, and you are the last signer, Safe{Wallet} contracts allow you to not actually sign the final transaction. Instead, as your last parameter, you input your address and the Safe{Wallet} will check that whoever sent the transaction is the last signer.

The Gnosis Safe developers realized they could save gas by using a different, but equally strong, form of proof for the final signer: the `msg.sender`.

In the EVM, `msg.sender` is an unforgeable global variable. When you send a transaction from your wallet (0xf39F...), the EVM guarantees that within that transaction's execution, the `msg.sender` will be 0xf39F.... No one else on the planet can send a transaction that results in that `msg.sender` unless they have your private key.

```bash
calldata: 0x474cf53d0000000000000000000000009f07eebdf3675f60dcec65a092f1821fb99726f3000000000000000000000000f39fd6e51aad88f6f4ce6ab8827279cfffb922660000000000000000000000000000000000000000000000000000000000000000

âœ— cast 4byte-calldata 0x474cf53d0000000000000000000000009f07eebdf3675f60dcec65a092f1821fb99726f3000000000000000000000000f39fd6e51aad88f6f4ce6ab8827279cfffb922660000000000000000000000000000000000000000000000000000000000000000

1) "depositETH(address,address,uint16)"
0x9F07eEBdf3675f60dCeC65a092F1821Fb99726F3 (ZKsync WrappedTokenGatewayV3)
0xf39Fd6e51aad88F6F4ce6aB8827279cffFb92266
0

---
âœ— cast 4byte-calldata 0x6a7612020000000000000000000000004087d2046A7435911fC26DCFac1c2Db26957Ab720000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000014000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001e00000000000000000000000000000000000000000000000000000000000000064474cf53d0000000000000000000000004087d2046a7435911fc26dcfac1c2db26957ab720000000000000000000000004087d2046a7435911fc26dcfac1c2db26957ab720000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000035277d26a45add5775f21256159f089769892cea5b0000000000000000000000000000000000000000000000000000000000000000010000000000000000000000

1) "execTransaction(address,uint256,bytes,uint8,uint256,uint256,uint256,address,address,bytes)"
0x4087d2046A7435911fC26DCFac1c2Db26957Ab72
0
0x474cf53d0000000000000000000000004087d2046a7435911fc26dcfac1c2db26957ab720000000000000000000000004087d2046a7435911fc26dcfac1c2db26957ab720000000000000000000000000000000000000000000000000000000000000000
0
0
0
0
0x0000000000000000000000000000000000000000
0x0000000000000000000000000000000000000000
0x277d26a45add5775f21256159f089769892cea5b000000000000000000000000000000000000000000000000000000000000000001
------

âœ— cast 4byte-calldata 0x474cf53d0000000000000000000000004087d2046a7435911fc26dcfac1c2db26957ab720000000000000000000000004087d2046a7435911fc26dcfac1c2db26957ab720000000000000000000000000000000000000000000000000000000000000000

1) "depositETH(address,address,uint16)"
0x4087d2046A7435911fC26DCFac1c2Db26957Ab72
0x4087d2046A7435911fC26DCFac1c2Db26957Ab72
0
0
```

## Decoding the Signature

### Contract Signature (EIP-1271 Standard)

* This is used when an owner of the Safe is another smart contract.
* A smart contract doesn't have a private key, so it can't create a normal signature. Instead, it has a function called `isValidSignature` that can be called to verify its approval of a hash.
* When using this method, the `v` value is set to 1 (0x01). The `r` value is set to the `contract-owner's address`.
* When the Safe sees v=1, it makes a call to that contract owner and asks, "Is this transaction hash valid for you?"

The signatures parameter in a Gnosis Safe transaction is a concatenation of one or more 65-byte signatures. Each signature is composed of three parts: r, s, and v.

For the provided signature `0x277d26a45add5775f21256159f089769892cea5b000000000000000000000000000000000000000000000000000000000000000001`:

* r: 0x277d26a45add5775f21256159f089769892cea5b000000000000000000000000 (first 32 bytes)
* s: 0x0000000000000000000000000000000000000000000000000000000000000000 (next 32 bytes)
* v: 0x01 (last byte)

Correct signature: `0xf39Fd6e51aad88F6F4ce6aB8827279cffFb92266000000000000000000000000000000000000000000000000000000000000000001`

`Result -> rejected`
